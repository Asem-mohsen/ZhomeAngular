@if(product){

    <!-- Header -->
    <div class="container pt-3">
        <ul class="list-unstyled thm-breadcrumb thm-breadcrumb__two">
            <li><a routerLink="/home">Home</a></li>
            <li><a routerLink="/shop">Shop</a></li>
            <li>
                {{product.Name | titlecase }}
            </li>
        </ul>
    </div>

        <!-- Details -->
        <section class="product-details NearestDiv">
            <div class="container">
                <div class="row RowReverseInArabic justify-content-center">
                    <div class="col-lg-6">
                        <div class="product-details__image">
                            <img class="img-fluid MainUpperImage" [src]="product.MainImage" width="500px" height="500px" [alt]="product.Name" />
                            <a href="#" class="product-details__img-popup img-popup">
                                <i class="fa fa-search"></i>
                            </a>
                        </div>
                        <div class="additional-images-container">
                            <div class="swiper additional-images-slider">
                              <owl-carousel-o [options]="ImagesSlider">
                                  @for (image of productImages ; track $index){
                                      <ng-template carouselSlide>
                                        <div class="swiper-slide">
                                            <div class="additional-image m-2">
                                                <img class="img-fluid h-100" [src]="image.Image" style="width:130px;object-fit: cover;" [alt]="product.Name" />
                                            </div>
                                        </div>
                                      </ng-template>

                                  }
                              </owl-carousel-o>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="product-details__content ">
                            <!-- Product With Sale -->
                                <h1 class="product-details__title">
                                    {{product.Name}}
                                </h1>
                                @if(product.sale){
                                    <input type="hidden" name="PriceAfterSale" [value]="product.sale.PriceAfter" >
                                    <p class="product-details__price">{{ product.sale.PriceAfter | currency:'EGP' }} </p>
                                    <p class="product-details__price" style="text-decoration: line-through; font-size:19px">{{ product.Price | currency:'EGP' }}</p>
                                }
                                @else{
                                    <p class="product-details__price">{{ product.Price | currency:'EGP' }}</p>
                                }

                                <p class="product-details__text">
                                    {{ product.Description }}
                                </p>
                                <p class="product-details__categories">
                                    <span class="text-uppercase"> Category </span>
                                    <a routerLink="/category">
                                        {{ product.subcategory.category.Category }}
                                    </a>
                                    <br />
                                    <span class="text-uppercase"> Brand  </span>
                                    <a routerLink="/brand">
                                        {{ product.brand.Brand }}
                                    </a>
                                </p>

                                <div class="product-details__button-block d-grid gap-1">
                                  <input type='hidden' name='Quantity' [value]="product.Quantity" />
                                  @if(product.Quantity > 0){
                                    <div class="quantity-spinner">
                                      <button (click)="decrementQuantity()" [disabled]="quantity <= 1">-</button>
                                      <input type="number" [(ngModel)]="quantity" min="1" [max]="product.Quantity" [id]="'quantity-'+product.ID">
                                      <button (click)="incrementQuantity()" [disabled]="quantity >= product.Quantity">+</button>
                                    </div>
                                    <!-- <button (click)="addToCart()" class="thm-btn product-details__cart-btn ml-3">
                                      Add to Cart <span>+</span>
                                    </button> -->
                                  }
                                  @else if(product.Quantity <= 0){
                                    <p class='OutStock'> Out of Stock </p>
                                  }
                                </div>
                                @if(product.Quantity > 0){
                                    <p class="product-details__availabelity">
                                        <span>Availability</span>
                                        <i class='fa-solid fa-check'></i> Available In stock
                                    </p>
                                }
                                @else{
                                    <p class="product-details__availabelity">
                                        <span>Availability</span>
                                        <span style='color: red;'><i class='fa-solid fa-xmark' style='color: red;'></i> CurrentlyOutofstock </span>
                                    </p>
                                }

                                <div class="Product-Platforms DisplayFlex">
                                    @for(platform of productPlatforms ; track $index){
                                        <a href="">
                                            <div class="platform">
                                                <img [src]="platform.Logo" [alt]="platform.Platform">
                                                <p>{{platform.Platform}}</p>
                                            </div>
                                        </a>
                                    }
                                </div>
                                <p class="product-details__social">
                                    <a href="" target="_blank"><i class="fa-brands fa-facebook-f"></i></a>
                                    <a href=""  target="_blank"><i class="fa-brands fa-twitter"></i></a>
                                    <a href="" target="_blank"><i class="fa-brands fa-instagram"></i></a>
                                </p>
                        </div>
                    </div>
                    <hr class="separator">

                    <div class="col-lg-12">
                        <div class="container d-grid justify-content-center">
                            <h2 class="ProductDetails-Text">
                               {{product.product_details.Title}}
                            </h2>
                            <div class="Images-ProductsDetails">
                                <div class="Image-One-ProductDetails fadeInUp">
                                    <img [src]="product.product_details.CoverImage" alt="Cover Image">
                                </div>
                            </div>
                            <div class="Text-under-images-ProductDetails">
                                <div class="text-one-ProductDetails">
                                    <div class="top-text">
                                        <img [src]="product.brand.Logo" [alt]="product.brand.Brand">
                                        <h3>Brand</h3>
                                    </div>
                                    <div class="bottom-text">
                                        <p>
                                            {{ product.Name + ' is a ' + product.brand.Brand}}
                                        </p>
                                    </div>

                                </div>
                                <div class="text-one-ProductDetails">
                                    <div class="top-text">
                                    <i class="fa-solid fa-folder"></i>
                                    <h3>Platform</h3>
                                    </div>
                                    <div class="bottom-text">
                                        <div class="Product-Platforms">
                                            @for(platform of productPlatforms ; track $index){
                                                <a href="">
                                                    <div class="platform">
                                                        <img [src]="platform.Logo" [alt]="platform.Platform">
                                                        <p>{{platform.Platform}}</p>
                                                    </div>
                                                </a>
                                            }
                                        </div>
                                    </div>
                                </div>
                                @if(product.InstallationCost){
                                    <div class="text-one-ProductDetails">
                                        <div class="top-text">
                                            <i class="fa-solid fa-gears"></i>
                                            <h3>Professional Installation</h3>
                                        </div>
                                        <div class="bottom-text">
                                            <p>
                                                Professional Installation {{ product.InstallationCost | currency:'EGP' }}.
                                            </p>
                                        </div>
                                    </div>
                                }
                                <div class="text-one-ProductDetails">
                                    <div class="top-text">
                                        <i class="fa-solid fa-house-signal"></i>
                                        <h3>Technology</h3>
                                    </div>
                                    <div class="bottom-text">
                                        <p>
                                            {{ getTechnologyString() }}
                                        </p>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>

                    <!-- {{-- Features --}} -->
                    <div class="Features-Product-Page mt-5 pt-5">
                        <h2>Features</h2>
                        <div class="container">
                            <div class="card-slider-wrapper">
                                <div class="card-slider">
                                    <div class="feature-container mt-5 pt-3">
                                        <owl-carousel-o [options]="FeaturesSlider">
                                            @for (feature of product.features; track $index) {
                                                <ng-template carouselSlide>
                                                    <div class="Feature-details">
                                                        <img [src]="feature.Image" [alt]="feature.Feature">
                                                        <div class="bottom-text">
                                                        <h3>{{feature.Feature}}</h3>
                                                        <p>{{feature.Description}}</p>
                                                        </div>
                                                    </div>
                                                </ng-template>

                                            }
                                        </owl-carousel-o>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Expert Review -->
                    <div class="mt-4" style="border-bottom:1px solid #eeee; ">
                        <div class="product-details__review-form">
                            <h2 class="mb-4 text-center">Expert Review</h2>
                            <!-- Reviews -->
                            <div class="product-details__review mb-4">
                                <div class="ExpertReview m-auto mt-5">
                                    <div class="product-details__review-form">
                                        <div class="product-details__review-single">
                                            <div class="product-details__review-left">
                                                <img src="assets/dist/img/avatar2.png" width="70px" height="70px" alt="Image" />
                                            </div>
                                            <div class="product-details__review-right">
                                                <div class="product-details__review-top">
                                                    <div class="product-details__review-top-left">
                                                        <h3 class="product-details__review-title">{{product.evaluations.admin}}</h3>
                                                        <span class="product-details__review-sep">-</span>
                                                        <span class="product-details__review-date">Expert Eng</span>
                                                    </div>
                                                </div>
                                                <p class="product-details__review-text">
                                                    {{product.evaluations.Evaluation}}
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Product Part 2 -->
                <div class="row LessMarginHere mt-5 pt-5">
                    <div class="col-lg-6">
                        <div class="product-details__content ProductDetails_Section_last">
                                <h3 class="product-details__title">
                                    {{product.product_details.Title}}
                                </h3>
                                <ul>
                                    <li>
                                        <span><i class="fa-solid fa-check"></i></span>
                                        <p>{{product.brand.Brand + " Brand" }} </p>
                                    </li>
                                    <li>
                                        <span><i class="fa-solid fa-check"></i></span>
                                        <p>
                                            Compitable With
                                            @for(platform of productPlatforms ; track $index){
                                                    {{platform.Platform}}
                                            }
                                            Platfrom
                                        </p>
                                    </li>
                                    @for(feature of product.features ; track $index){
                                        <li>
                                            <span><i class="fa-solid fa-check"></i></span>
                                            <p>{{feature.Feature}}</p>
                                        </li>
                                    }

                                    <li>
                                        <span><i class="fa-solid fa-check"></i></span>
                                        <p> Free Transportation</p>
                                    </li>

                                    @if(product.InstallationCost){
                                        <li>
                                            <span><i class="fa-solid fa-check"></i></span>
                                            <p>Professional Installation {{ product.InstallationCost | currency:'EGP' }}</p>
                                        </li>
                                    }

                                </ul>
                                <div class="product-details__button-block d-grid gap-1">
                                    <input type='hidden' name='Quantity' [value]="product.Quantity" />
                                    @if(product.sale){
                                        <input type="hidden" name="PriceAfterSale" [value]="product.sale.PriceAfter">
                                    }

                                    @if(product.Quantity > 0){
                                      <button
                                        type="button"
                                        class="thm-btn product-details__cart-btn"
                                        (click)="addToCart(product.ID)"
                                        title="Add to Cart"
                                      >
                                      @if(!isAdded){
                                        Add to Cart
                                      }
                                      @else {
                                        <i class="fa-solid fa-check"></i>
                                      }
                                      </button>
                                    }
                                    @else if(product.Quantity <= 0){
                                        <p class='OutStock text-center' style='font-size: 20px;'> Out of Stock</p>
                                    }
                                </div>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="product-details__image LastProductDetails">
                            <img class="img-fluid" [src]="product.MainImage" [alt]="product.Name" />
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- User Reviews and FAQ , Video and Description-->
        <section class="product-details">
            <div class="container">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="product-details__content">
                            <div class="accrodion-grp" data-grp-name="product-details__accrodion">
                                <div class="accrodion">
                                    <div class="accrodion-title">
                                        <a data-toggle="collapse" href="#Description" role="button" aria-expanded="false"  aria-controls="Description">Product Description</a>
                                    </div>
                                    <div class="collapse " id="Description">
                                        <div class="inner">
                                            <div class="product-details__review-form">
                                                <!-- Description -->
                                                <div class="Product-spacification">
                                                    <div class="container">
                                                        <div class="Details">
                                                            <h5>Capacity</h5>
                                                            <div class="Details-info">
                                                                <p>Capacity(m)</p>
                                                                <span>{{ product.product_details.Capacity + 'm'}}</span>
                                                            </div>
                                                        </div>
                                                        <div class="Details">
                                                            <h5>Noise</h5>
                                                            <div class="Details-info">
                                                                <p>Noise Level(dBA)</p>
                                                                <span>50 dBA</span>
                                                            </div>
                                                        </div>
                                                        <div class="Details">
                                                            <h5> Physical Specification</h5>
                                                            <div class="many-details">
                                                                <div class="Details-info">
                                                                    <p>Net Dimension(WxHxD)</p>
                                                                    <span>{{ product.product_details.Width + 'x' + product.product_details.Height +  'x' + product.product_details.Length}}</span>
                                                                </div>
                                                                <div class="Details-info">
                                                                    <p>Net Weight(kg)</p>
                                                                    <span>{{ product.product_details.Weight + 'KG'}}</span>
                                                                </div>
                                                                <div class="Details-info">
                                                                    <p>Color</p>
                                                                    <div class="Colorsdiv">
                                                                        @if(product.product_details.Color){
                                                                            <span class="color" [ngStyle]="{'background-color': product.product_details.Color}">
                                                                            </span>
                                                                        }
                                                                        @else if (product.product_details.Color2){
                                                                            <span class="color" [ngStyle]="{'background-color': product.product_details.Color2}">
                                                                            </span>
                                                                        }
                                                                        @else if (product.product_details.Color3){
                                                                            <span class="color" [ngStyle]="{'background-color': product.product_details.Color3}">
                                                                            </span>
                                                                        }
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        @if(product.product_details.AirPurification){
                                                            <div class="Details">
                                                                <h5>Air Purification</h5>
                                                                <div class="many-details">
                                                                    <div class="Details-info">
                                                                        <p>Indcator (cleanliness)</p>
                                                                        <span>{{ product.product_details.AirPurification }}</span>
                                                                    </div>

                                                                    @if(product.product_details.PreFilter){
                                                                        <div class="Details-info">
                                                                            <p>Pre Filter</p>
                                                                            <span>
                                                                                @if(product.product_details.PreFilter){
                                                                                    Yes
                                                                                }
                                                                                @else{
                                                                                    No
                                                                                }
                                                                            </span>
                                                                        </div>
                                                                    }
                                                                    @if(product.product_details.DustCollecting){
                                                                        <div class="Details-info">
                                                                            <p>Dust Collecting</p>
                                                                            <span> {{ product.product_details.DustCollecting ? 'Yes' : 'No' }}</span>
                                                                        </div>
                                                                    }
                                                                    @if(product.product_details.DeodorizingFilter){
                                                                        <div class="Details-info">
                                                                            <p>Deodorizing Filter</p>
                                                                            <span>{{ product.product_details.DeodorizingFilter  ? 'Yes' : 'No' }}</span>
                                                                        </div>
                                                                    }
                                                                </div>
                                                            </div>
                                                        }
                                                        @if(product.product_details.PowerConsumption){
                                                            <div class="Details">
                                                                <h5>Electrical Date</h5>
                                                                <div class="Details-info">
                                                                    <p>Power Consumption(W)</p>
                                                                    <span>{{ product.product_details.PowerConsumption +' W' }}</span>
                                                                </div>
                                                            </div>
                                                         }
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- Tech details -->
                                @if(product.faqs){
                                    <div class="accrodion">
                                        <div class="accrodion-title">
                                            <a data-toggle="collapse" href="#FAQ" role="button" aria-expanded="false" aria-controls="FAQ">Technical Details</a>
                                        </div>
                                        <div class="collapse " id="FAQ">
                                            <div class="inner">
                                                <div class="product-details__review-form mt-3">
                                                    <!-- FAQ -->
                                                    <div class="product-details__review mb-4">
                                                        @for(faq of product.faqs; track $index){
                                                            <div class="product-details__review-single" style="padding: 1px 30px;border:none;justify-content: left;">
                                                                <div class="product-details__review-right">
                                                                    <div class="FAQ"  style="gap: 0px;">
                                                                        <div class="Question">
                                                                            {{ faq.Question }}
                                                                        </div>
                                                                        <div class="Answer">
                                                                            <p class="product-details__review-text mt-3"> {{ faq.Answer }}</p>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        }

                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                }
                                <!-- Video -->
                                @if(product.product_details.Video){
                                    <div class="accrodion">
                                        <div class="accrodion-title">
                                            <a data-toggle="collapse" href="#Video" role="button"  aria-expanded="false" aria-controls="Video">Video</a>
                                        </div>
                                        <div class="collapse " id="Video">
                                            <div class="inner">
                                                <div class="product-details__review-form text-center">
                                                    <!-- Video -->
                                                    <div class="product-details__review mb-5">
                                                        <source [src]="product.product_details.Video" type="video/mp4">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                }
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- You may also like -->
        <section>
            <div class="container">
                <h3 class="related-product__title">You May Also Like</h3>
                <div class="related-product__carousel">
                    <owl-carousel-o [options]="ProductsSlider">
                        @for(product of products ; track $index){
                            <ng-template carouselSlide>
                                <div class="item">
                                    <app-product-card [product]="product"></app-product-card>
                                </div>
                            </ng-template>

                        }
                    </owl-carousel-o>
                </div>
            </div>
        </section>

    <script>
        $(document).ready(function () {
            $('.additional-image, .product-details__img-popup').click(function () {
                var imageUrl = $(this).closest('.additional-image, .product-details__image').find('img').attr('src');
                $('.product-details__image img').attr('src', imageUrl);
                $('.product-details__img-popup').attr('href', imageUrl);
            });
        });
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
        const cardSlider = document.querySelector(".card-slider");
        const prevButton = document.querySelector(".prev-button");
        const nextButton = document.querySelector(".next-button");
        const featureContainer = document.querySelector(".feature-container");
        let currentPosition = 0;
        const cardWidth = 360 + 40; // card width + margin

        function updateSliderPosition() {
            cardSlider.style.transform = `translateX(${currentPosition}px)`;
        }

        function checkButtonsState() {
            const totalWidth = featureContainer.scrollWidth;
            const visibleWidth = featureContainer.offsetWidth;

            prevButton.disabled = currentPosition >= 0;
            nextButton.disabled = currentPosition <= visibleWidth - totalWidth;
        }

        nextButton.addEventListener("click", () => {
            const visibleWidth = featureContainer.offsetWidth;
            const totalWidth = featureContainer.scrollWidth;
            currentPosition = Math.max(visibleWidth - totalWidth, currentPosition - cardWidth);
            updateSliderPosition();
            checkButtonsState();
        });

        prevButton.addEventListener("click", () => {
            currentPosition = Math.min(0, currentPosition + cardWidth);
            updateSliderPosition();
            checkButtonsState();
        });

        // Initial check for buttons state
        checkButtonsState();

        // Recheck on window resize
        window.addEventListener('resize', () => {
            currentPosition = 0;
            updateSliderPosition();
            checkButtonsState();
        });
        });
    </script>

}
